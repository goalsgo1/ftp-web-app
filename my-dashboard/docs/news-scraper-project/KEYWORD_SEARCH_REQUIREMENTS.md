# 키워드 기반 뉴스 스크래핑 요구사항 정리

## 🎯 목표
사용자가 입력한 키워드(예: "블록체인")로 뉴스를 검색하고, **해당 키워드가 실제로 포함된 뉴스만** 수집하는 시스템 구현

## ❌ 현재 문제점

### 1. 키워드 검색 결과가 부정확함
- "블록체인" 키워드로 검색 시 80개 기사 수집
- 하지만 수집된 80개 기사 중 **블록체인과 관련된 기사가 하나도 없음**
- 검색 결과가 키워드와 무관한 일반 뉴스들임

### 2. 검색 방식의 문제
- 네이버 뉴스 검색 API를 사용하고 있으나 결과가 부정확
- 검색 결과에서 실제로 키워드가 포함되어 있는지 검증하지 않음
- 제목만 확인하고 본문을 확인하지 않는 경우가 있음

## ✅ 원하는 기능

### 1. 키워드 검색 기능
- 사용자가 키워드를 입력하면 (예: "블록체인")
- 네이버/다음 뉴스에서 해당 키워드로 검색
- **제목, 본문, 태그, 키워드 중 하나라도 키워드가 포함된 뉴스만 수집**

### 2. 일반 뉴스 앱 방식
- 일반 뉴스 앱(네이버 뉴스, 다음 뉴스 등)의 검색 기능처럼 동작
- 검색 결과가 검색어와 관련성이 높아야 함
- 검색 결과의 정확도가 높아야 함

### 3. 검색 결과 검증
- 검색으로 가져온 기사의 제목과 본문에 실제로 키워드가 포함되어 있는지 확인
- 키워드가 포함되지 않은 기사는 제외
- 정확한 키워드 매칭 보장

## 🔧 현재 구현 상태

### 구현된 기능
1. ✅ 키워드 입력 UI (뉴스 스크래퍼 상세 페이지)
2. ✅ 키워드 저장 기능 (Firebase Feature 문서에 저장)
3. ✅ 네이버 뉴스 검색 API 호출 (`searchNaverNewsByKeyword` 함수)
4. ✅ 기사 본문 크롤링 기능
5. ✅ 키워드 필터링 로직 (하지만 키워드 검색 모드에서는 비활성화됨)

### 문제가 있는 부분
1. ❌ 네이버 검색 결과 파싱이 정확하지 않음
2. ❌ 검색 결과에서 키워드 검증 로직이 없음
3. ❌ 키워드 검색 모드에서 필터링을 스킵하여 부정확한 결과 저장

## 📋 요구사항 상세

### 필수 기능
1. **정확한 키워드 검색**
   - 네이버/다음 뉴스 검색 API 활용
   - 검색 결과에서 키워드가 실제로 포함된 기사만 선별
   - 제목과 본문 모두 확인

2. **검색 결과 검증**
   - 수집한 기사의 제목에 키워드가 포함되어 있는지 확인
   - 수집한 기사의 본문에 키워드가 포함되어 있는지 확인
   - 키워드가 하나라도 포함되지 않으면 제외

3. **키워드 매칭 로직**
   - 대소문자 구분 없이 매칭 (한글은 불필요하지만 영어 키워드 대비)
   - 부분 문자열 매칭 (예: "블록체인"이 "블록체인 기술"에 포함)
   - 제목 또는 본문 중 하나라도 매칭되면 포함

### 선택적 기능
1. 여러 키워드 지원 (OR 조건)
2. 태그/키워드 필드 검색 (데이터 구조에 있는 경우)
3. 검색 결과 정렬 (관련도 순, 날짜 순)

## 🔍 현재 코드 구조

### 주요 파일
- `app/lib/utils/newsScraper.ts`: 뉴스 스크래핑 로직
  - `searchNaverNewsByKeyword()`: 네이버 뉴스 키워드 검색
  - `scrapeAllNews()`: 전체 스크래핑 오케스트레이션
- `app/api/news-scraper/scrape/route.ts`: 스크래핑 API 엔드포인트
  - 키워드 검색 모드와 일반 모드 분기
  - 키워드 필터링 로직

### 문제 코드 위치
- `app/lib/utils/newsScraper.ts`의 `searchNaverNewsByKeyword()` 함수
  - 네이버 검색 결과 파싱이 정확하지 않음
  - 검색 결과에 키워드 검증이 없음

## 💡 해결 방향 제안

1. **네이버 검색 결과 파싱 개선**
   - 검색 결과 HTML 구조를 정확히 분석
   - 올바른 선택자로 기사 링크 추출

2. **검색 결과 검증 로직 추가**
   - 검색으로 가져온 모든 기사에 대해
   - 제목과 본문에 키워드가 포함되어 있는지 확인
   - 포함되지 않은 기사는 제외

3. **키워드 필터링 활성화**
   - 키워드 검색 모드에서도 키워드 필터링 적용
   - 이중 검증으로 정확도 향상

4. **에러 처리 및 로깅 강화**
   - 검색 실패 시 상세한 로그 출력
   - 검색 결과 검증 실패 시 경고 메시지

## ❓ Claude Code에게 질문할 내용

다음과 같은 형태로 질문하시면 됩니다:

---

**질문 프롬프트:**

```
나는 Next.js 기반의 뉴스 스크래핑 시스템을 개발 중입니다. 

현재 상황:
- 사용자가 키워드(예: "블록체인")를 입력하면 네이버 뉴스에서 검색하여 뉴스를 수집합니다
- 하지만 검색 결과로 80개를 가져왔는데, 실제로는 블록체인과 관련 없는 일반 뉴스들만 나옵니다
- 검색 결과가 키워드와 무관하게 나오는 문제가 있습니다

요구사항:
1. 키워드로 검색했을 때, 해당 키워드가 제목 또는 본문에 포함된 뉴스만 수집해야 합니다
2. 일반 뉴스 앱처럼 검색 결과가 검색어와 관련성이 높아야 합니다
3. 검색 결과의 정확도를 보장해야 합니다

현재 코드:
- `app/lib/utils/newsScraper.ts`에 `searchNaverNewsByKeyword()` 함수가 있습니다
- 네이버 검색 결과를 HTML로 파싱하여 기사 링크를 추출합니다
- 각 기사 본문도 크롤링하여 제목 + 본문을 저장합니다

문제:
1. 네이버 검색 결과 파싱이 정확하지 않아 관련 없는 기사가 포함됨
2. 검색 결과에서 키워드 검증 로직이 없어 부정확한 결과가 저장됨
3. 키워드 검색 모드에서는 키워드 필터링을 스킵하여 문제가 더 커짐

어떻게 개선해야 할까요?
```

---

위 프롬프트를 사용하여 Claude Code에게 질문하시면 도움을 받을 수 있습니다.

